<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Old World Auction</title>
    <link th:href="@{/auctionList.css}" rel="stylesheet"/>
    <link th:href="@{/common.css}" rel="stylesheet"/>
    <link th:href="@{/login.css}" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch("/loggedUser")
                .then(response => response.json())
                .then(data => {
                    displayUser(data);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        });

        function displayUser(user){
            const userDiv = document.getElementById("user");
            userDiv.innerHTML = "";
            if(user.username != "") {
                userDiv.innerHTML = `
                  <button class="dropbtn">Welcome, ` + user.username + `</button>
                  <div class="dropdown-content">
                    <a href="#">Manage Account</a>
                    <a href="#">Manage Items</a>
                    <a href="/logout">Log Out</a>
                  </div>
                `;
            } else {
                let loginButton = document.createElement("a");
                loginButton.setAttribute("href", "/login-page");
                loginButton.textContent = "Login";
                userDiv.appendChild(loginButton);
            }
        }
    </script>
    <script th:inline="javascript">
        var items = /*[[${items}]]*/ [];
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
     fetch("/allItemsJson")
         .then(response => response.json())
         .then(data => {
             console.log('Retrieved items:', data);
             displayAuctionItems(data);
         })
         .catch(error => {
             console.error('Error fetching data:', error);
         });
 });

 function displayAuctionItems(items) {
     const auctionListDiv = document.getElementById("gallery");
     auctionListDiv.innerHTML = ''; // Clear previous content

     items.forEach(item => {
         const contentDiv = document.createElement("div");
         contentDiv.classList.add("content");

         // Convert base64-encoded image data to an actual image
         const imageData = atob(item.image);
         const imageDataUrl = `data:image/jpeg;base64,${item.image}`;

         const imageElement = document.createElement("img");
         imageElement.src = imageDataUrl;

         contentDiv.appendChild(imageElement);

         // Log the decoded image data to the console
         console.log('Decoded Image Data:', imageData);

         contentDiv.innerHTML += `
             <h3>${item.name}</h3>
             <p>$${item.currentBid}</p>
             <h6>${item.description}</h6>
             <button class="buy-1" onclick="buyNow('${item.name}')">Buy Now</button>
             <button class="save" onclick="saveItem('${item.name}')">Save</button>
         `;

         auctionListDiv.appendChild(contentDiv);
     });
 }

 function buyNow(itemName) {
     const url = `/getItem?name=${encodeURIComponent(itemName)}`;
     window.location.href = url;
 }

    </script>
</head>
<body>
<header>
    <div class="nav">
        <ul class="headerNav">
            <a href="/">Home</a>
            <a class="active">Auctions</a>
            <a href="/register-page">Register</a>
            <a href="/addItem">Create</a>
            <a href="#contact">Contact</a>
            <div id="user" class="dropdown" style="float:right; color: white"></div>
        </ul>
    </div>
</header>
<section>
    <h1> Auction Items</h1>
    <div id="gallery"></div>
</section>
</body>
</html>
